generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// O enum para os papéis de utilizador
enum Role {
  ADMIN
  DOCTOR
  PATIENT
}

model User {
  id              String    @id @default(cuid())
  email           String    @unique
  name            String
  password        String
  role            Role      @default(PATIENT)
  imageUrl        String?   
  phone           String?
  birthDate       DateTime?
  gender          String?
  insurance       String?
  insuranceNumber String?
  specialty       String[]  // Array de strings para as especialidades do médico

  // Relações (vamos adicionar mais tarde)
  appointmentsAsDoctor  Appointment[] @relation("DoctorAppointments")
  appointmentsAsPatient Appointment[] @relation("PatientAppointments")
  prescriptionsAsDoctor Prescription[] @relation("DoctorPrescriptions")
  prescriptionsAsPatient Prescription[] @relation("PatientPrescriptions")

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Appointment {
  id          String      @id @default(cuid())
  date        DateTime
  specialty   String

  // Relação com o Médico
  doctorId    String
  doctor      User        @relation("DoctorAppointments", fields: [doctorId], references: [id])

  // Relação com o Paciente
  patientId   String
  patient     User        @relation("PatientAppointments", fields: [patientId], references: [id])
  
  prescriptions Prescription[]

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Prescription {
  id          String      @id @default(cuid())
  farmaco     String
  dose        String
  frequencia  String
  observacoes String?

  // Relação com o Médico que prescreveu
  doctorId    String
  doctor      User        @relation("DoctorPrescriptions", fields: [doctorId], references: [id])
  
  // Relação com o Paciente
  patientId   String
  patient     User        @relation("PatientPrescriptions", fields: [patientId], references: [id])
  
  // Relação com a Consulta
  appointmentId String
  appointment Appointment @relation(fields: [appointmentId], references: [id])

  criadoEm    DateTime    @default(now())
}